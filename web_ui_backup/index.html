<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RVC2API Dashboard</title>
    <!-- Prevent theme flash on initial load -->
    <script>
      (function() {
        const savedTheme = localStorage.getItem("rv-theme") || "system";

        function getSystemTheme() {
          if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
            return "dark";
          }
          return "light";
        }

        function applyTheme(theme) {
          const html = document.documentElement;
          // Remove all theme classes
          html.classList.remove("dark", "light");
          html.setAttribute("data-theme", theme);

          if (theme === "dark") {
            html.classList.add("dark");
          }
          // Light is default state (no class needed for Tailwind)
        }

        // Resolve and apply theme
        const systemTheme = getSystemTheme();
        const effectiveTheme = savedTheme === "system" ? systemTheme : savedTheme;
        applyTheme(effectiveTheme);

        // Listen for system theme changes if using system theme
        if (savedTheme === "system" && window.matchMedia) {
          const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
          const handleSystemThemeChange = (e) => {
            const newTheme = e.matches ? "dark" : "light";
            applyTheme(newTheme);
          };

          // Use newer addEventListener if available, fallback to addListener
          if (mediaQuery.addEventListener) {
            mediaQuery.addEventListener("change", handleSystemThemeChange);
          } else if (mediaQuery.addListener) {
            mediaQuery.addListener(handleSystemThemeChange);
          }
        }

        // Debug helper for theme switching (available in console)
        window.debugTheme = function() {
          const html = document.documentElement;
          console.log("Current theme classes:", Array.from(html.classList));
          console.log("CSS variables:", {
            background: getComputedStyle(document.documentElement).getPropertyValue('--background'),
            foreground: getComputedStyle(document.documentElement).getPropertyValue('--foreground'),
            primary: getComputedStyle(document.documentElement).getPropertyValue('--primary')
          });
        };

        // Call it once on load
        setTimeout(window.debugTheme, 100);
      })();
    </script>
  </head>
  <body class="bg-background text-foreground h-screen overflow-hidden">
    <div id="root" class="h-screen"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
